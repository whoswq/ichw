### 高速缓冲存储器
##### *Cache的意义与作用原理*
寄存器和内存之间读写速度的差距是很大的，而内存和磁盘之间的读写速度差距也很大。当内存需要传数据给寄存器，假如有这样一个读写速度处于寄存器和内存之间的东西，可以帮忙存储内存要传的数据，然后再把这些数据传给寄存器，这样不就提高了速度了吗。高速缓存存储器就是这样一个东西。为了解决存储器系统的容量、存取速度及单位成本之间的矛盾，可以采用 Cache- 主存存储结构，Cache的存储速度远大于内存（但不及寄存器），存储能力比寄存器大很多，在主存和 CPU 之间设置高速缓冲存储器 Cache ，把正在执行的指令代码单元附近的一部分指令代码或数据从主存装入 Cache 中，供 CPU 在一段时间内使用，在一定容量 Cache 的条件下，我们可以做到使 CPU 大部分取指令代码及进行数据读写的操作都只要通过访问Cache来实现，而不需要长时间地访问内存而导致CPU空闲，降低运行效率。
当中央处理器存取主存储器某一单元时，计算机硬件就自动地将包括该单元在内的那一组单元内容调入高速缓冲存储器，中央处理器即将存取的主存储器单元很可能就在刚刚调入到高速缓冲存储器的那一组单元内。于是，中央处理器就可以直接对高速缓冲存储器进行存取。在整个处理过程中，如果中央处理器绝大多数存取主存储器的操作能为存取高速缓冲存储器所代替，计算机系统处理速度就能显著提高。若CPU需要的数据没有存入Cache，那么此时我们就需要从内存中寻找相应的数据存入Cache空的部分，或者删去Cache中的一些数据存入新的数据，那么，在Cache中存入数据和删去数据的策略将显著影响其效率，即算法对于Cache效率的影响非常大。


##### *Cache的结构*
层次结构的每一层都缓存来自较低一层的数据。数据总是以块为基本单位在每一层之间传递，块的大小只在相互传递的两层之间是相同的，并且一般是越位与底层的块大小越大，这样就弥补了底层存储器每次访问的所花销的大量的时间。

|层次|存储器名称|数据传输|
|:-:|:-:|:-:|
|L0|寄存器| 速度最快 |
|L1|L1高速缓存|寄存器访问L1中的数据|
|L2|L2高速缓存|L1访问L2中的数据|
|L3|L3高速缓存|L2访问L3中的数据|
|L4|内存|L3访问内存中的数据|


##### *替换策略*
为了保证CPU访问时有较高的命中率，Cache中的内容应该按一定的算法替换。
Cache的替换算法对命中率的影响：当新的主存块需要调入Cache并且它的可用空间位置又被占满时，需要替换掉Cache的数据，这就产生了替换策略（算法）问题。根据程序局部性规律可知：程序在运行中，总是频繁地使用那些最近被使用过的指令和数据。这就提供了替换策略的理论依据。 替换算法目标就是使Cache获得最高的命中率。Cache替换算法是影响代理缓存系统性能的一个重要因素，一个好的Cache替换算法可以产生较高的命中率。
（1）随机法（RAND法） 随机替换算法就是用随机数发生器产生一个要替换的块号，将该块替换出去，此算法简单、易于实现，而且它不考虑Cache块过去、现在及将来的使用情况，但是没有利用上层存储器使用的“历史信息”、没有根据访存的局部性原理，故不能提高Cache的命中率，命中率较低。
（2）先进先出法（FIFO法） 先进先出（First-In-First-Out，FIFO）算法。就是将最先进入Cache的信息块替换出去。FIFO算法按调入Cache的先后决定淘汰的顺序，选择最早调入Cache的字块进行替换，它不需要记录各字块的使用情况，比较容易实现，系统开销小，其缺点是可能会把一些需要经常使用的程序块（如循环程序）也作为最早进入Cache的块替换掉，而且没有根据访存的局部性原理，故不能提高Cache的命中率。因为最早调入的信息可能以后还要用到，或者经常要用到，如循环程序。此法简单、方便，利用了主存的“历史信息”， 但并不能说最先进入的就不经常使用，其缺点是不能正确反映程序局部性原理，命中率不高，可能出现一种异常现象。
（3）近期最少使用法（LRU法） 近期最少使用（Least Recently Used，LRU）算法。这种方法是将近期最少使用的Cache中的信息块替换出去。该算法较先进先出算法要好一些。但此法也不能保证过去不常用将来也不常用。 LRU法是依据各块使用的情况，总是选择那个最近最少使用的块被替换。这种方法虽然比较好地反映了程序局部性规律，但是这种替换方法需要随时记录Cache中各块的使用情况，以便确定哪个块是近期最少使用的块。LRU算法相对合理，但实现起来比较复杂，系统开销较大。通常需要对每一块设置一个称为计数器的硬件或软件模块，用以记录其被使用的情况。
